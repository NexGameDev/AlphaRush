<script>
/* ======================
   WORD LISTS (TIDAK DIUBAH)
======================= */

const easyWords = [...(EASY LIST SAMA PERSIS)...];
const mediumWords = [...(MEDIUM LIST SAMA PERSIS)...];
const hardWords = [...(HARD LIST SAMA PERSIS)...];

/* ======================
   GAME STATE
======================= */
let mode = "";
let activeList = [];
let levelIndex = 0;
let score = 0;
let currentAnswer = "";
let timerID = null;
let timeLeft = 0;

/* ======================
   SAVE & LOAD SYSTEM
======================= */
function saveProgress() {
  localStorage.setItem("ws_mode", mode);
  localStorage.setItem("ws_level", levelIndex);
  localStorage.setItem("ws_score", score);
}

function loadProgress() {
  const m = localStorage.getItem("ws_mode");
  const l = localStorage.getItem("ws_level");
  const s = localStorage.getItem("ws_score");

  if(!m || l === null || s === null) return null;

  return {
    mode: m,
    level: parseInt(l),
    score: parseInt(s)
  };
}

function clearProgress() {
  localStorage.removeItem("ws_mode");
  localStorage.removeItem("ws_level");
  localStorage.removeItem("ws_score");
}

/* ======================
   ON PAGE LOAD â†’ Show Continue Button
======================= */
window.onload = () => {
  const data = loadProgress();
  if(data){
    const btn = document.createElement("button");
    btn.className = "modeBtn";
    btn.innerText = "CONTINUE PROGRESS (" + data.mode.toUpperCase() + ")";
    btn.onclick = continueProgress;
    document.getElementById("menu").appendChild(btn);
  }
};

/* ======================
   CONTINUE GAME
======================= */
function continueProgress(){
  const data = loadProgress();
  if(!data) return;

  mode = data.mode;
  levelIndex = data.level;
  score = data.score;

  if(mode === "easy") activeList = easyWords.slice();
  else if(mode === "medium") activeList = mediumWords.slice();
  else if(mode === "hard") activeList = hardWords.slice();

  document.getElementById("menu").style.display = "none";
  document.getElementById("lastQuestionBtn").style.display = "none";
  document.getElementById("lastQuestionPanel").style.display = "none";
  document.getElementById("completed").style.display = "none";

  document.getElementById("game").style.display = "block";
  document.getElementById("difficultyText").innerText = "Difficulty: " + mode.toUpperCase();

  loadLevel();
}

/* ======================
   START NEW MODE
======================= */
function startMode(selected){
  clearProgress(); // reset progress baru

  mode = selected;

  if(mode === "easy") activeList = easyWords.slice();
  else if(mode === "medium") activeList = mediumWords.slice();
  else if(mode === "hard") activeList = hardWords.slice();

  levelIndex = 0;
  score = 0;
  currentAnswer = "";

  clearInterval(timerID);

  document.getElementById("menu").style.display = "none";
  document.getElementById("lastQuestionBtn").style.display = "none";
  document.getElementById("lastQuestionPanel").style.display = "none";
  document.getElementById("lastQuestionResult").innerText = "";
  document.getElementById("completed").style.display = "none";

  document.getElementById("game").style.display = "block";
  document.getElementById("difficultyText").innerText = "Difficulty: " + mode.toUpperCase();

  saveProgress();
  loadLevel();
}

/* ======================
   LOAD LEVEL
======================= */
function loadLevel(){
  if(levelIndex >= activeList.length){
    document.getElementById("scrambled").innerText = "";
    document.getElementById("letterButtons").innerHTML = "";
    document.getElementById("answer").innerText = "";
    document.getElementById("levelText").innerText = "All levels completed!";
    document.getElementById("scoreText").innerText = "Score: " + score;
    document.getElementById("timerText").innerText = "";
    document.getElementById("lastQuestionBtn").style.display = "inline-block";
    saveProgress();
    return;
  }

  const entry = activeList[levelIndex];

  document.getElementById("levelText").innerText =
    "Level " + (levelIndex+1) + " / " + activeList.length;
  document.getElementById("scoreText").innerText = "Score: " + score;

  document.getElementById("scrambled").innerText = entry.scrambled;
  document.getElementById("answer").innerText = "";
  currentAnswer = "";

  const cont = document.getElementById("letterButtons");
  cont.innerHTML = "";

  [...entry.scrambled].forEach(ch=>{
    const d = document.createElement("div");
    d.className = "letter";
    d.innerText = ch;
    d.onclick = ()=>{
      currentAnswer += ch;
      document.getElementById("answer").innerText = currentAnswer;
      checkAnswer();
    };
    cont.appendChild(d);
  });

  clearInterval(timerID);
  if(mode === "medium"){
    timeLeft = 90;
    document.getElementById("timerText").innerText = "Time left: " + timeLeft + "s";
    timerID = setInterval(()=>{
      timeLeft--;
      document.getElementById("timerText").innerText = "Time left: " + timeLeft + "s";
      if(timeLeft <= 0){
        clearInterval(timerID);
        levelIndex++;
        saveProgress();
        loadLevel();
      }
    },1000);
  }
  else if(mode === "hard"){
    timeLeft = 60;
    document.getElementById("timerText").innerText = "Time left: " + timeLeft + "s";
    timerID = setInterval(()=>{
      timeLeft--;
      document.getElementById("timerText").innerText = "Time left: " + timeLeft + "s";
      if(timeLeft <= 0){
        clearInterval(timerID);
        levelIndex++;
        saveProgress();
        loadLevel();
      }
    },1000);
  }
  else {
    document.getElementById("timerText").innerText = "";
  }
}

/* ======================
   CHECK ANSWER
======================= */
function checkAnswer(){
  const entry = activeList[levelIndex];

  if(currentAnswer === entry.word){
    score++;
    levelIndex++;
    clearInterval(timerID);
    saveProgress();
    loadLevel();
  }
}

function resetAnswer(){
  currentAnswer = "";
  document.getElementById("answer").innerText = "";
}

/* ======================
   LAST QUESTION (tidak diubah)
======================= */
function showLastQuestion(){
  document.getElementById("lastQuestionBtn").style.display = "none";
  document.getElementById("lastQuestionPanel").style.display = "block";
}

function lastQuestionAnswer(ans){
  const el = document.getElementById("lastQuestionResult");
  if(ans){
    el.innerText = "contact me: vorexus999@gmail.com";
  } else {
    el.innerText = "okay.";
  }
  document.querySelectorAll("#lastQuestionPanel button").forEach(b=>b.style.display="none");
  document.getElementById("completed").style.display = "block";

  clearProgress(); // bersihkan save setelah selesai
}

window.addEventListener("beforeunload", ()=>clearInterval(timerID));
                          </script>
